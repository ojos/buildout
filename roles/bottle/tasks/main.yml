---
- name: Stop supervisord service.
  service: >
    name=supervisord
    state=stopped
    enabled=yes
- name: Install Bottle in pip.
  command: >
    {{ xbuild_python_install_dir_prefix }}/bin/pip install {{ item }}
  with_items: "{{ bottle_dependent_packages }}"
- name: Create app directory.
  file: >
    path="{{ bottle_app_dir }}"
    state=directory
    owner="{{ gunicorn_user }}"
    group="{{ gunicorn_user }}"
    mode=0755
- name: Create gunicorn config file for supervisord.
  template: >
    src=gunicorn.conf.tpl
    dest="{{ supervisord_conf_dir }}/conf.d/gunicorn-bottle.conf"
    owner="{{ supervisord_user }}"
    group="{{ supervisord_user }}"
    mode=0644
- name: Start supervisord service.
  service: >
    name=supervisord
    state=started
    enabled=yes
